<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>KOTH Transcript Viewer</title>
  <style>
    * { box-sizing: border-box; }
    body {
      background: #1a1a1a;
      color: #e0e0e0;
      font-family: sans-serif;
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 24px;
      background: #111;
      border-bottom: 1px solid #333;
    }
    #main {
      flex: 1;
      display: flex;
      overflow: hidden;
    }
    #left {
      width: 260px;
      min-width: 260px;
      max-width: 260px;
      background: #141414;
      padding: 20px;
      overflow-y: auto;
      border-right: 1px solid #333;
    }
    #right {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }
    input {
      width: 100%;
      padding: 8px;
      margin-bottom: 16px;
      font-size: 1rem;
      background: #222;
      border: 1px solid #444;
      color: #eee;
    }
    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    li {
      margin: 6px 0;
    }
    a {
      color: #36a3d9;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    mark {
      background: yellow;
      color: black;
    }
    .result-line {
      margin: 10px 0;
      padding: 10px;
      background: #222;
      border-left: 3px solid #36a3d9;
    }
    .result-episode {
      font-weight: bold;
      color: #999;
    }
    .quote {
      margin-top: 4px;
      white-space: pre-wrap;
    }
    #transcript {
      margin-top: 20px;
      white-space: pre-wrap;
    }
    .mode-toggle {
      font-size: 1rem;
      padding: 6px 12px;
      background: #333;
      border: 1px solid #666;
      color: #ccc;
      cursor: pointer;
    }
    .mode-toggle:hover {
      background: #444;
    }
  </style>
</head>
<body>
  <header>
    <h1>KOTH Transcript Viewer</h1>
    <button class="mode-toggle" onclick="toggleMode()" id="modeBtn">Switch to Search View</button>
  </header>
  <div id="main">
    <div id="left">
      <input type="text" id="search" placeholder="Search all transcripts..." style="display: none;" />
      <ul id="episodeList"></ul>
    </div>
    <div id="right">
      <h2 id="transcript-title">Transcript</h2>
      <div id="transcript">Select an episode to load or switch to Search View above.</div>
    </div>
  </div>

  <script>
    const folder = 'scripts/';
    const files = [
      "King of the Hill S01E01 Pilot.txt",
      "King of the Hill S01E02 Square Peg.txt",
      "King of the Hill S01E03 Order of the Straight Arrow.txt",
      "King of the Hill S01E04 Hank's Got the Willies.txt"
    ];
    const transcripts = {};
    const lineIndex = [];
    const transcriptEl = document.getElementById("transcript");
    const transcriptTitleEl = document.getElementById("transcript-title");
    const episodeList = document.getElementById("episodeList");
    const searchInput = document.getElementById("search");
    const modeBtn = document.getElementById("modeBtn");

    let mode = "browse";

    function toggleMode() {
      mode = (mode === "browse") ? "search" : "browse";
      modeBtn.textContent = mode === "browse" ? "Switch to Search View" : "Switch to Browse View";
      searchInput.style.display = mode === "search" ? "block" : "none";
      episodeList.style.display = mode === "browse" ? "block" : "none";
      transcriptTitleEl.textContent = mode === "browse" ? "Transcript" : "Search Results";
      transcriptEl.innerHTML = mode === "browse" ? "Select an episode to load." : "Type at least 2 characters to search.";
    }

    files.forEach(file => {
      fetch(folder + file)
        .then(res => res.text())
        .then(text => {
          transcripts[file] = text;
          const lines = text.split(/\r?\n/);
          lines.forEach((line, i) => {
            if (line.trim()) {
              lineIndex.push({ file, lineNumber: i + 1, text: line });
            }
          });
        });

      const li = document.createElement("li");
      const a = document.createElement("a");
      a.href = "#";
      a.textContent = file.replace("King of the Hill ", "").replace(".txt", "");
      a.onclick = () => {
        transcriptTitleEl.textContent = a.textContent;
        transcriptEl.textContent = transcripts[file] || "Loading...";
      };
      li.appendChild(a);
      episodeList.appendChild(li);
    });

    function highlight(text, query) {
      return text.replace(new RegExp(`(${query})`, 'gi'), '<mark>$1</mark>');
    }

    searchInput.addEventListener("input", e => {
      const query = e.target.value.trim().toLowerCase();
      if (!query || query.length < 2) {
        transcriptEl.innerHTML = "Type at least 2 characters to search.";
        return;
      }
      const matches = lineIndex.filter(entry => entry.text.toLowerCase().includes(query));
      if (!matches.length) {
        transcriptEl.innerHTML = "No matches found.";
        return;
      }
      transcriptEl.innerHTML = matches.slice(0, 200).map(match => `
        <div class="result-line">
          <div class="result-episode">${match.file.replace("King of the Hill ", "").replace(".txt", "")}</div>
          <div class="quote">${highlight(match.text, query)}</div>
        </div>
      `).join('');
    });
  </script>
</body>
</html>
